<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./style.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <title>Homework 1</title>

    <!-- Load Bulma from CDN (consider saving it to repository instead) -->
    <!-- https://bulma.io/ -->
<!--    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.8.0/css/bulma.min.css"> -->
<link rel="stylesheet" href="https://jenil.github.io/bulmaswatch/nuclear/bulmaswatch.min.css">

    <!-- Load Font Awesome 5 (free) icons -->
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  </head>

  <body>

    <section class="hero is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Data Visualizations</h1>
          <h2 class="subtitle">Homework 1</h2>
        </div>
      </div>
    </section>

    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
      <div class="container">
        <div class="navbar-brand">

          <a class="navbar-item" href="index.html">
            <span class="icon"><i class="fas fa-home"></i></span>
            <span>Home</span>
          </a>

        </div>

        <div id="main-menu" class="navbar-menu has-text-weight-medium">
          <!-- Left navbar items -->
          <div class="navbar-start">
  		  <a class="navbar-item is-active" href="barchartcustom.html" title="Bar Chart">
              <span class="icon"><i class="fas fa-chart-bar"></i></span>
              <span>Bar Chart</span>
            </a>

  		  <a class="navbar-item" href="linechart.html" title="Line Chart">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span>Line Chart</span>
            </a>

  		  <a class="navbar-item" href="areachart.html" title="Area Chart">
                <span class="icon"><i class="fas fa-chart-area"></i></span>
                <span>Area Chart</span>
             </a>
          </div>

          <!-- Right navbar items -->
          <div class="navbar-end">
            <a class="navbar-item" href="#grade" title="Grade">
              <span class="icon"><i class="fas fa-tasks"></i></span>
              <span>Grade</span>
            </a>

            <a class="navbar-item" href="#about" title="About">
              <span class="icon"><i class="fas fa-info-circle"></i></span>
              <span>About</span>
            </a>
          </div>
        </div>
      </div>
    </nav>

  <section class="section">
    <div class="container">
      <!-- Begin page content -->
      <div class="content">
        <h1 class="title">
          BarChart visualization
        </h1>
        <p class="subtitle">
          Purpose
        </p>
        <p>The purpose of this visualization is to get overall understading which geographical regions used for transit mostly.

        <h3 id="wrangling">Wrangling</h3>

        <p>For purposes of this bar chart the data was filtered by Activity Type Code to be "Thru / Transit". Used .csv file can be found <a href="https://github.com/usf-cs360-spring2020/homework1-BettyRain/blob/gh-pages/barchartdata.csv">here</a> and grouped by GEO Region.


        <h3 id="prototype">Tableau Prototype</h3>

        <img src="barchart.jpg" alt="BarChart Prototype">

        <p>Prototype was done using Tableau. The data used: "Passenger Number" (sum for each GEO Region group) (as y scale) and "GEO Region" (as x scale).


        <h3 id="visualizations">Visualization</h2>

        <!--
        <iframe src="./codeBarChart.html" seamless width = "1000px" height = "1000px"></iframe>
        <script src="barscript.js" width="200" height="200"></script>
       -->

       <div class="form-control"
     style="height:100%;
     width:100%;">
       <svg>
        </svg>

        <script>
          // location of data file
      		let csv = 'barchartdata.csv';

          // configuration of svg/plot area
      		let config = {
        		'svg': {},
        		'margin': {},
        		'plot': {}
      		};

          config.svg.height = 450;
          config.svg.width = config.svg.height * 1.618; // golden ratio

          config.margin.top = 15;
          config.margin.right = 10;
          config.margin.bottom = 30;
          config.margin.left = 10;

          config.plot.x = config.margin.left;
          config.plot.y = config.margin.top;
          config.plot.width = config.svg.width - config.margin.left - config.margin.right;
          config.plot.height = config.svg.height - config.margin.top - config.margin.bottom;

          // setup svg
          let svg = d3.select('body').select('svg');
          svg.attr('width', config.svg.width);
          svg.attr('height', config.svg.height);

          //get data
          d3.csv(csv, convertRow).then(buildBars)

          // helper method to make translating easier
      		function translate(x, y) {
        		return 'translate(' + x + ',' + y + ')';
      		}

          // function to convert each row
          // we need only two columns for bar chart
      		function convertRow(row, index) {
        		let out = {};
            out.values = []
            out.values.region = ""
            out.values.num = 0

        		for (let col in row) {
          		switch (col) {
            		case 'GEO Region':
              	out.values.region = row[col];
              	break;

            		case 'Passenger Count':
              	out.values.num = parseInt(row[col]);
              	break;
              }
        	}
        		return out;
      		}
          function buildBars(data) {
            let svg = d3.select("body").select("svg");
            console.assert(svg.size() == 1);

        		// get all of the value objects (with date and value) from the rows
        		let values = data.map(d => d.values);
            var merged = Object.values(values.reduce((r, o) => {
        			r[o.region] = r[o.region] || {region: o.region, num : 0};
        			r[o.region].num += +o.num;
        			return r;
      			},{}));

        		let countMax = d3.max(merged);

            let min = 0;
            let max = countMax.num;
            if (isNaN(max)) {
          		max = 0;
       			}
            console.log("count bounds:", [min, max]);

            let margin = {
          	top:    15,
         	 	right:  15,
          	bottom: 30,
        	  left:  85
        		};

            // now we can calculate how much space we have to plot
        		let bounds = svg.node().getBoundingClientRect();
        		let plotWidth = bounds.width - margin.right - margin.left;
        		let plotHeight = bounds.height - margin.top - margin.bottom;

            let count = merged.map(d => d.count);
            let countScale = d3.scaleLinear()
          		.domain([min, max])
          		.range([plotHeight, 0])
          	//	.nice(); // rounds the domain a bit for nicer output

            let regions = merged.map(d => d.region);
            regions.sort();
            let regionScale = d3.scaleBand()
          		.domain(regions) // all region (not using the count here)
          		.rangeRound([0, plotWidth])
          		.paddingInner(0.23); // space between bars

            let plot = svg.append("g").attr("id", "plot");
       			plot.attr("transform", translate(margin.left,margin.top));

        		console.assert(plot.size() == 1);

        		let xAxis = d3.axisBottom(regionScale);
        		let yAxis = d3.axisLeft(countScale);
            yAxis
              .tickFormat(d3.formatPrefix(".0", 1e3))

            let xGroup = plot.append("g").attr("id", "x-axis");
        		xGroup.call(xAxis);
        		xGroup.attr("transform", translate(0, plotHeight));

        		let yGroup = plot.append("g").attr("id", "y-axis");
        		yGroup.call(yAxis);


            let pairs = Array.from(merged);


       			console.log("pairs:", pairs);
            let bars = plot.selectAll("rect")
         			.data(pairs)

            //grid lines before bars
         		var gridlines = d3.axisLeft()
                           	.tickFormat("")
                           	.tickSize(-plotWidth)
                           	.scale(countScale);

         		svg.append("g")
            	.attr("class", "grid")
            	.attr("transform", translate(margin.left,margin.top))
            	.call(gridlines);

              //bars
        		svg.selectAll(".bar")
            	.data(pairs)
            	.enter().append("rect")
            	.attr("class", "bar")
            	.attr("x", function(d) { return regionScale(d.region)+89; })
            	.attr("width", regionScale.bandwidth())
            	.attr("y", function(d) { return countScale(d.num)+15; })
            	.attr("height", function(d) { return plotHeight - countScale(d.num); });

              // text label for the y axis
            plot.append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 7 - margin.left)
              .attr("x",0 - (plotHeight / 2))
              .attr("dy", "1em")
              .style("text-anchor", "middle")
              .text("Passenger Number");

              // text label for the x axis
          plot.append("text")
            .attr("transform",translate(plotWidth/2,17))
            .style("text-anchor", "middle")
            .text("GEO Region");
            }
        </script>
      </div>

        <p> The JavaScript code for this visualization can be found <a href="https://github.com/usf-cs360-spring2020/homework1-BettyRain/blob/gh-pages/codeBarChart.html">here</a>.

        <div id="vis"></div>

        <h3 id="analysis">Analysis</h3>
        <p>Passenger count is encoded by the length of the bar, so longer bars represent higher passenger count. GEO region is encoded by the bar position, so each bar is responsible for a particular region.
        <p>From this bar chart we can see that US has the most number of transit places, that we can count as obvious because in US airport there are a lot of domestic flights going thru one state to another. The more interesting bar is the next largest bar. It shows that the most international flights (not US anymore) are using Asia as a transit point. There are multiple conclusions can be done from that. Firslty, there are a lot of Asian passengers coming to US and back. Secondoly, US citinzens are flying to Asia. We can also make the conclusion that there are less people flying to "right" hemisphere, because there is no Asia transit.

        <h2 id="about">About</h2>

        <!-- Profile box -->
        <!-- https://bulma.io/documentation/layout/media-object/ -->
        <article class="media">
          <figure class="media-left">
            <p class="image is-128x128"><img class="is-rounded" src="profile.png"></p>
          </figure>

          <div class="media-content">
            <div class="content">
              <p>
                <strong>Betty</strong><br/>
                CS Major, <a href="https://www.usfca.edu/">University of San Francisco</a><br/>
                <em>Expected Graduation: May 2020</em><br/>
                <i class="fas fa-envelope"></i> <a href="mailto:username@dons.usfca.edu">eozerova@dons.usfca.edu</a>
              </p>

              <p>
                Computer Science student, enthusiast and explorer. Cinematography geek, learning to do everything CS related from editing to visual effects. Love working with hardware, especially motorcycles.
              </p>

              <!-- https://bulma.io/documentation/elements/tag/ -->
              <div class="heading">Skills</div>

              <div class="tags">
                <span class="button is-primary is-outlined is-small is-rounded">Java</span>
                <span class="button is-primary is-outlined is-small is-rounded">Go</span>
                <span class="button is-primary is-outlined is-small is-rounded">Python</span>
                <span class="button is-primary is-outlined is-small is-rounded">JavaScript</span>
                <span class="button is-primary is-outlined is-small is-rounded">HTML</span>
                <span class="button is-primary is-outlined is-small is-rounded">CSS</span>
              </div>
            </div>
          </div>
        </article>
        <!-- End profile box -->

      </div>
      <!-- End page content -->
    </div>
  </section>

  <!-- Page footer -->
  <!-- https://bulma.io/documentation/layout/footer/ -->
  <footer class="footer">
    <div class="content has-text-centered is-size-7">
      <p>
        <a href="#top">
          <span class="fas fa-arrow-up"></span>
          <span class="has-text-weight-medium">Back to Top</span>
        </a>
      </p>

      <p>
        <a href="https://github.com/BettyRain" class="button is-small" style="padding-left: 1em; padding-right: 1em;">
          <i class="fab fa-github-alt"></i>&nbsp;<strong>Github</strong>
        </a>

        <a href="https://fontawesome.com/" class="button is-small" style="padding-left: 1em; padding-right: 1em;">
          <i class="fab fa-font-awesome"></i>&nbsp;<strong>FontAwesome</strong>
        </a>

        <a href="https://bulma.io" class="button is-small">
          <img src="https://bulma.io/images/made-with-bulma--semiblack.png" alt="Made with Bulma" width="128" height="24">
        </a>
      </p>
    </div>
  </footer>
  <!-- End page footer -->

  <!-- Mobile menu responsiveness -->
  <!-- https://bulma.io/documentation/components/navbar/ -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

    if ($navbarBurgers.length > 0) {
      $navbarBurgers.forEach( el => {
        el.addEventListener('click', () => {
          const target = el.dataset.target;
          const $target = document.getElementById(target);
          el.classList.toggle('is-active');
          $target.classList.toggle('is-active');
        });
      });
    }
  });
  </script>
  <!-- End mobile menu responsiveness -->
  </body>

</html>
